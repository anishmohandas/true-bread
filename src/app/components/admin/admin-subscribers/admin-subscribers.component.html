<div class="subscribers-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <h2 class="section-title">Subscribers</h2>
      <p class="section-desc">Manage all newsletter subscribers.</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline" (click)="loadSubscribers()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2">
          <polyline points="23 4 23 10 17 10" />
          <polyline points="1 20 1 14 7 14" />
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
        </svg>
        Refresh
      </button>
      <button class="btn btn-primary" (click)="exportCsv()" [disabled]="filteredSubscribers.length === 0">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
          <polyline points="7 10 12 15 17 10" />
          <line x1="12" y1="15" x2="12" y2="3" />
        </svg>
        Export CSV
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-row" *ngIf="!isLoading">
    <div class="stat-card">
      <div class="stat-value">{{ totalCount }}</div>
      <div class="stat-label">Total Subscribers</div>
    </div>
    <div class="stat-card stat-card--green">
      <div class="stat-value">{{ activeCount }}</div>
      <div class="stat-label">Active</div>
    </div>
    <div class="stat-card stat-card--gray">
      <div class="stat-value">{{ totalCount - activeCount }}</div>
      <div class="stat-label">Inactive</div>
    </div>
  </div>

  <!-- Success Message -->
  <div class="success-alert" *ngIf="successMessage">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2">
      <polyline points="20 6 9 17 4 12" />
    </svg>
    {{ successMessage }}
  </div>

  <!-- Error Message -->
  <div class="error-alert" *ngIf="errorMessage">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2">
      <circle cx="12" cy="12" r="10" />
      <line x1="12" y1="8" x2="12" y2="12" />
      <line x1="12" y1="16" x2="12.01" y2="16" />
    </svg>
    {{ errorMessage }}
  </div>

  <!-- Loading -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading subscribers...</p>
  </div>

  <!-- Table -->
  <div class="table-card" *ngIf="!isLoading">
    <!-- Search -->
    <div class="table-toolbar">
      <div class="search-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" class="search-icon">
          <circle cx="11" cy="11" r="8" />
          <line x1="21" y1="21" x2="16.65" y2="16.65" />
        </svg>
        <input type="text" class="search-input" placeholder="Search by name or email..." (input)="onSearch($event)" />
      </div>
      <span class="result-count">{{ filteredSubscribers.length }} result(s)</span>
    </div>

    <!-- Table -->
    <div class="table-wrapper">
      <table class="data-table" *ngIf="filteredSubscribers.length > 0">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Email</th>
            <th>Subscribed On</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let sub of filteredSubscribers; let i = index">
            <td class="col-id">{{ sub.id }}</td>
            <td class="col-name">{{ sub.name }}</td>
            <td class="col-email">{{ sub.email }}</td>
            <td class="col-date">{{ sub.subscription_date | date:'MMM d, y' }}</td>
            <td class="col-status">
              <span class="badge" [class.badge--active]="sub.is_active" [class.badge--inactive]="!sub.is_active">
                {{ sub.is_active ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td class="col-actions">
              <button class="action-btn action-btn--delete" (click)="deleteSubscriber(sub.id)"
                [disabled]="deletingId === sub.id" title="Delete subscriber">
                <svg *ngIf="deletingId !== sub.id" xmlns="http://www.w3.org/2000/svg" width="15" height="15"
                  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6" />
                  <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
                  <path d="M10 11v6" />
                  <path d="M14 11v6" />
                  <path d="M9 6V4h6v2" />
                </svg>
                <svg *ngIf="deletingId === sub.id" xmlns="http://www.w3.org/2000/svg" width="15" height="15"
                  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="spin">
                  <path d="M21 12a9 9 0 1 1-6.219-8.56" />
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="filteredSubscribers.length === 0">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#ccc"
          stroke-width="1.5">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
          <circle cx="9" cy="7" r="4" />
          <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
          <path d="M16 3.13a4 4 0 0 1 0 7.75" />
        </svg>
        <p>{{ searchQuery ? 'No subscribers match your search.' : 'No subscribers found.' }}</p>
      </div>
    </div>
  </div>
</div>